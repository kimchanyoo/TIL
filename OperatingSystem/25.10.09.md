# 프로세스와 스레드

## 프로세스
* 운영체제로부터 자원을 할당받은 **작업**의 단위
* 실행 중인 프로그램을 의미
    * 프로그램이란 **파일이 저장장치에 저장되어 있지만 메모리에는 올라가 있지 않은 정적인 상태**

<img width="600" height="482" alt="Image" src="https://github.com/user-attachments/assets/1b955dea-c379-4653-839c-342dac98a4dd" />

---

### 프로세스의 자원 구조
프로그램이 실행되어 프로세스가 만들어지면 다음과 같은 4개의 메모리 영역을 구성하여 할당받게 됨

<img width="236" height="366" alt="Image" src="https://github.com/user-attachments/assets/63f7bbcf-40cd-4e3d-88a9-d6b68529ef0c" />

| 크기의 변화 | 영역 | 
| :--- | :--- |
| 정적 할당 영역 | 코드 영역, 데이터 영역 | 
| 동적 할당 영역 | 힙 영역, 스택 영역 |

#### 코드 영역(Code/Text)
* 실행할 수 있는 코드, 즉 **기계어로 이루어진 명령어가 저장**
* 데이터가 아닌 CPU가 실행할 명령어가 담겨 있기 때문에 쓰기 금지
* Read-Only

#### 데이터 영역(Data)
* 프로그램이 실행되는 동안 **유지할 데이터가 저장되는 공간**
    * 전역 변수, 각종 데이터
        * `.data` : 전역 변수 또는 `static` 변수 등 프로그램이 사용하는 데이터를 저장
        * `.BSS` : 초기값 없는 전역 변수, `static` 변수가 저장
        * `.rodata` : `const`같은 상수 키워드 선언 된 변수나 문자열 상수가 저장

#### 힙 영역(Heap)
* 프로그래머가 **직접 할당 할 수 있는 공간**
    * 프로그래밍 과정에서 메모리 공간을 할당했다면 언젠가는 해당 공간을 반환해야함
* 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간

**주의 사항**
```
메모리 공간을 반환하지 않으면 할당한 공간은 메모리 내에 계속 남아 메모리 낭비를 초래함
이를 메모리 누수라고 함
```

#### 스택 영역(Stack)
* **데이터를 일시적으로 저장하는 공간**
    * 매개 변수, 지역 변수와 같이 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장
* Stack은 함수의 호출과 함께 할당되고, 함수의 호출이 완료되면 소멸

---

### 프로세스의 상태
**생성상태(New)**
* 프로세스가 메모리에 올라와 실행준비를 완료한 상태
    * 즉, PCB가 생성됨
* 프로세스에 대한 PCB가 생성된 후 준비 상태로 전환

**준비 상태(Ready)**
* 생성된 프로세스가 CPU 자원을 얻을 때까지 대기하는 상태
    * CPU는 한 번에 하나의 프로세스만 실행될 수 있음

**실행 상태(Run)**
* 준비 상태에 있는 프로세스 중 하나가 CPU 자원을 얻어 실제 작업을 수행하는 상태
* 실행 상태에 있는 프로세스는 일정 시간동안 CPU 사용가능
* 주어진 시간 내 작업이 모두 끝나면 완료 상태로 전환
    * 그렇지 못한 경우 준비 상태로 전환

**대기 상태(Waiting)**
* 실행 상태에 있는 프로세스가 입출력을 요청하면 입출력이 완료될때까지 기다리는 상태
* 작업 효율 향상을 위함

**완료 상태(Terminated)**
* 실행이 완료된 상태

<img width="800" height="474" alt="Image" src="https://github.com/user-attachments/assets/cd348b69-8c8d-4acd-ad5c-b398c1a8917c" />

---

### 문맥 교환 (Context Switching)
* CPU가 한 프로세스에서 다른 프로세스로 전환할 때 발생하는 과정
* CPU가 한번에 하나의 프로세스만을 실행할 수 있기 때문에, 여러 개의 프로세스를 번갈아가며 실행하여 CPU의 활용률을 높이기 위함

<img width="800" height="544" alt="Image" src="https://github.com/user-attachments/assets/4b9d6838-ab98-4f76-9444-0569e1c12ff1" />

<img width="960" height="540" alt="Image" src="https://github.com/user-attachments/assets/fa8d75db-8efc-475f-b379-6d76d129db8e" />

```
idle은 대기
executing은 실행
```

---

### PCB(Process Control Block)
* 운영체제에서 프로세스를 관리하기 위해 해당 프로세스의 상태 정보를 담고 있는 자료구조

<img width="856" height="399" alt="Image" src="https://github.com/user-attachments/assets/5cb95cbb-1d8d-4b64-aa62-1f8fbac75a59" />

#### 프로세스 식별자(PID)
* 각 프로세스를 구분하는 식별자

#### 메모리 관련 정보
* 프로세스의 메모리 위치 정보
* 메모리 보호를 위한 경계 레지스터와 한계 레지스터

#### 각 중간 값
* 프로세스가 사용했던 중간 값
    * 작업 중인 코드의 위치, 레지스터에 저장된 정보 등
* 시분할 시스템에서는 여러 프로세스가 번갈아 가며 실행되기 때문에, 다음 차례에 이어서 작업을 실행하기 위해서 상태 정보를 저장해야 함

## 스레드

### 프로세스의 한계
* 프로그램을 실행할 때, 프로세스를 하나만 사용해서 이용했었음
* 기술의 발전에 따라 프로그램이 복잡해지면서 프로세스 작업 하나만으로 프로그램을 실행시키기에 한계가 있었음
* 동일한 프로그램을 여러 프로세스로 만들게 되면, 그만큼의 메모리를 차지하고 CPU에게 받은 자원이 중복되어짐

### 스레드의 개념
* 프로세스 내에서 프로세스가 할당받은 자원을 이용하는 **실행의 흐름 단위**
    * 스레드가 여러개 있다는 것은 우리가 파일을 다운 받으면서 동시에 웹 서핑을 할 수 있는 것
* 하나의 프로세스 내에 반드시 하나 이상의 스레드를 가짐

<img width="700" height="623" alt="Image" src="https://github.com/user-attachments/assets/9e18a371-c021-410c-98cc-2215dc6f7b07" />

### 스레드의 자원 공유
* 스레드는 **프로세스의 자원을 공유하면서 프로세스의 실행 흐름의 일부가 되기 때문에 동시 작업 가능**
* **스레드는 Stack만 할당**받아 복사하고 나머지 3가지 영역에 대해서는 프로세스 내의 다른 스레드들과 공유하게 됨

<img width="800" height="297" alt="Image" src="https://github.com/user-attachments/assets/cc77b021-a03f-4c32-9711-16eb90341841" />

```
Stack은 함수 호출 시 전달되는 인자, 되돌아갈 주소값, 함수 내에서 선언하는 변수 등을 저장하는 메모리 공간이기 때문에, 독립적인 스택을 가진다는 것은 독립적인 함수 호출이 가능하다는 의미이다

그리고 독립적인 함수 호출이 가능하다는 것은 독립적인 실행 흐름이 추가된다는 의미이다

즉, Stack을 가짐으로써 스레드는 독립적인 실행 흐름을 가질 수 있게 되는 것이다
```

---
## 질문
### 프로세스 간에는 서로 자원 공유가 불가능한가?
* 프로세스끼리의 정보 공유는 아래와 같은 3가지로 가능하다
1. IPC(inter-Process Communication)을 사용한다
2. LPC(Local-Process Communication)을 사용한다
3. 별도로 공유 메모리를 만들어서 정보를 주고받도록 설정한다

* 다만, 이 경우에는 단순히 CPU 레지스터 교체뿐만 아니라 **RAM과 CPU 사이의 캐시 메모리까지 초기화되기 때문에 자원 부담이 크다**

#### IPC
* 각 프로세스들은 별도의 공간에서 실행되기 때문에 한 프로세스에서 다른 프로세스로 접근할 수 없음
* Messaing 모델과 Shared Memory 모델이 있음

<img width="777" height="517" alt="Image" src="https://github.com/user-attachments/assets/6fdb0a76-640a-4f33-b839-52f8ac0aa484" />

# 출처
* [프로세스와 스레드의 차이](https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4)
* [완전히 정복하는 프로세스 VS 스레드 개념](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4)
* [[OS] 프로세스와 스레드의 차이](https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html)
* [[CS 지식8.] 프로세스(Process)와 스레드(Thread)란?](https://somaz.tistory.com/265)
* [[운영체제] 프로세스와 스레드](https://velog.io/@aeong98/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C)

## 도서
* 혼자 공부하는 컴퓨터 구조 + 운영체제 